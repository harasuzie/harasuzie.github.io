<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë°°ì‹  ê²Œì„ - ë°” ê·¸ë˜í”„ + ì„¤ëª… ì¶”ê°€</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    :root {
      --bg: #f0f0f0;
      --text: #000;
      --btn-coop: #4CAF50;
      --btn-betray: #f44336;
      --btn-restart: #555;
    }
    body.dark {
      --bg: #121212;
      --text: #e0e0e0;
      --btn-coop: #2e7d32;
      --btn-betray: #c62828;
      --btn-restart: #888;
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: sans-serif;
      text-align: center;
      padding: 10px;
      position: relative;
      transition: background 0.3s, color 0.3s;
    }
    h1 {
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    .intro {
      font-size: 14px;
      margin-bottom: 20px;
      line-height: 1.5;
    }
    .button {
      font-size: 20px;
      margin: 8px;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .cooperate {
      background-color: var(--btn-coop);
      color: white;
    }
    .betray {
      background-color: var(--btn-betray);
      color: white;
    }
    .restart {
      font-size: 16px;
      padding: 6px 16px;
      margin-top: 20px;
      background-color: var(--btn-restart);
      color: white;
      border: none;
      border-radius: 6px;
      display: none;
    }
    .mute-toggle, .dark-toggle {
      font-size: 14px;
      position: absolute;
      top: 10px;
      background: none;
      border: none;
      cursor: pointer;
      color: #666;
      text-decoration: underline;
    }
    #muteBtn { right: 10px; }
    #darkBtn { left: 10px; }
    .scoreboard, .result, .prediction, .stats {
      margin-top: 15px;
      font-size: 16px;
    }
    .result.animate {
      animation: pop 0.4s ease;
    }
    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .chart-container {
      display: none;
      margin: 20px auto;
      width: 100%;
      max-width: 320px;
    }
  </style>
</head>
<body>
  <button class="dark-toggle" onclick="toggleDarkMode()" id="darkBtn">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
  <button class="mute-toggle" onclick="toggleMute()" id="muteBtn">ğŸ”ˆ ìŒì†Œê±°</button>
  <h1>ğŸ¤ğŸ”ª ë°°ì‹  ê²Œì„</h1>
  <div class="intro">
    ğŸ¤” <strong>ë°°ì‹  ê²Œì„</strong>ì€ ë‹¹ì‹ ê³¼ ì»´í“¨í„°ê°€ ë§¤ í„´ <strong>í˜‘ë ¥ ğŸ¤</strong> ë˜ëŠ” <strong>ë°°ì‹  ğŸ”ª</strong> ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ëŠ” ì‹¬ë¦¬ì „ ê²Œì„ì…ë‹ˆë‹¤.<br>
    ì„œë¡œ í˜‘ë ¥í•˜ë©´ ëª¨ë‘ ë“ì í•˜ì§€ë§Œ, ë°°ì‹ ì€ ë” í° ì ìˆ˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
    <strong>ëª©í‘œ:</strong> 10ë¼ìš´ë“œ ë™ì•ˆ <u>ìµœëŒ€í•œ ë†’ì€ ì ìˆ˜ë¥¼ ì–»ê³  ì»´í“¨í„°ë³´ë‹¤ ìŠ¹ë¦¬</u>í•˜ì„¸ìš”!
  </div>
  <div class="prediction" id="prediction"></div>
  <p>ì„ íƒí•˜ì„¸ìš”:</p>
  <button class="button cooperate" onclick="play('í˜‘ë ¥')">í˜‘ë ¥ ğŸ¤</button>
  <button class="button betray" onclick="play('ë°°ì‹ ')">ë°°ì‹  ğŸ”ª</button>

  <div class="result" id="result"></div>
  <div class="scoreboard" id="scoreboard">ë‹¹ì‹ : 0 | ì»´í“¨í„°: 0</div>
  <div class="scoreboard" id="round">ë¼ìš´ë“œ: 1 / 10</div>
  <div class="scoreboard" id="highscore">ğŸ“ˆ ìµœê³  ê¸°ë¡: 0</div>

  <div class="chart-container" id="chartSection">
    <canvas id="scoreChart"></canvas>
  </div>

  <div class="stats" id="userStats"></div>
  <button class="restart" id="restartBtn" onclick="restartGame()">ğŸ” ë‹¤ì‹œí•˜ê¸°</button>

  <audio id="sfx-win" src="win.wav"></audio>
  <audio id="sfx-loose" src="loose.wav"></audio>
  <audio id="sfx-knife" src="knife.wav"></audio>
  <audio id="sfx-acquire" src="acquire.wav"></audio>
  <audio id="sfx-highscore" src="highscore.wav"></audio>

  <script>
    let userScore = 0;
    let computerScore = 0;
    let round = 1;
    const maxRounds = 10;
    let history = [];
    let userChoices = [];
    let computerStrategy = chooseStrategy();
    let highScore = localStorage.getItem('highScore') || 0;
    let muted = false;
    document.getElementById('highscore').innerText = `ğŸ“ˆ ìµœê³  ê¸°ë¡: ${highScore}`;

    const sfx = {
      win: document.getElementById('sfx-win'),
      loose: document.getElementById('sfx-loose'),
      knife: document.getElementById('sfx-knife'),
      acquire: document.getElementById('sfx-acquire'),
      highscore: document.getElementById('sfx-highscore')
    };

    function playSound(name) {
      if (!muted && sfx[name]) sfx[name].play();
    }

    function toggleMute() {
      muted = !muted;
      document.getElementById('muteBtn').innerText = muted ? 'ğŸ”‡ ìŒì†Œê±° í•´ì œ' : 'ğŸ”ˆ ìŒì†Œê±°';
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
      document.getElementById('darkBtn').innerText = document.body.classList.contains('dark') ? 'ğŸŒ ë¼ì´íŠ¸ëª¨ë“œ' : 'ğŸŒ™ ë‹¤í¬ëª¨ë“œ';
    }

    const ctx = document.getElementById('scoreChart');
    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['ë‹¹ì‹ ', 'ì»´í“¨í„°'],
        datasets: [{
          label: 'ìµœì¢… ì ìˆ˜',
          data: [0, 0],
          backgroundColor: ['#4CAF50', '#f44336']
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    function chooseStrategy() {
      const strategies = ['random', 'tit-for-tat', 'always-betray', 'always-cooperate'];
      return strategies[Math.floor(Math.random() * strategies.length)];
    }

    function predictComputerChoice() {
      if (round === 1) return { cooperate: 50, betray: 50 };
      const last = history[history.length - 1];
      return last === 'ë°°ì‹ ' ? { cooperate: 30, betray: 70 } : { cooperate: 70, betray: 30 };
    }

    function getSmartComputerChoice() {
      const last = history[history.length - 1];
      if (computerStrategy === 'random') return Math.random() < 0.5 ? 'í˜‘ë ¥' : 'ë°°ì‹ ';
      if (computerStrategy === 'tit-for-tat') return last || 'í˜‘ë ¥';
      return computerStrategy === 'always-betray' ? 'ë°°ì‹ ' : 'í˜‘ë ¥';
    }

    function play(userChoice) {
      if (round > maxRounds) return;
      const prediction = predictComputerChoice();
      document.getElementById('prediction').innerText = `ğŸ¤– ì˜ˆìƒ ì„ íƒ í™•ë¥  â†’ í˜‘ë ¥: ${prediction.cooperate}% | ë°°ì‹ : ${prediction.betray}%`;

      const computerChoice = getSmartComputerChoice();
      history.push(userChoice);
      userChoices.push(userChoice);

      let userGain = 0;
      let compGain = 0;

      if (userChoice === 'í˜‘ë ¥' && computerChoice === 'í˜‘ë ¥') {
        userGain = 3; compGain = 3; playSound('acquire');
      } else if (userChoice === 'í˜‘ë ¥' && computerChoice === 'ë°°ì‹ ') {
        userGain = 0; compGain = 5; playSound('loose');
      } else if (userChoice === 'ë°°ì‹ ' && computerChoice === 'í˜‘ë ¥') {
        userGain = 5; compGain = 0; playSound('knife');
      } else {
        userGain = 1; compGain = 1; playSound('win');
      }

      userScore += userGain;
      computerScore += compGain;

      document.getElementById('result').innerText = `ë‹¹ì‹ ì€ ${userChoice}, ì»´í“¨í„°ëŠ” ${computerChoice} â†’ ë‹¹ì‹  +${userGain}ì , ì»´í“¨í„° +${compGain}ì `;
      document.getElementById('result').classList.add('animate');
      setTimeout(() => document.getElementById('result').classList.remove('animate'), 400);

      document.getElementById('scoreboard').innerText = `ë‹¹ì‹ : ${userScore} | ì»´í“¨í„°: ${computerScore}`;
      round++;
      document.getElementById('round').innerText = `ë¼ìš´ë“œ: ${Math.min(round, maxRounds)} / ${maxRounds}`;

      if (round > maxRounds) {
        const winner = userScore > computerScore ? 'ğŸ‰ ë‹¹ì‹  ìŠ¹ë¦¬!' : userScore < computerScore ? 'ğŸ˜¢ ì»´í“¨í„° ìŠ¹ë¦¬!' : 'ğŸ¤ ë¬´ìŠ¹ë¶€!';
        document.getElementById('result').innerText += `\nê²Œì„ ì¢…ë£Œ â€” ${winner}`;
        document.getElementById('restartBtn').style.display = 'inline-block';

        if (userScore > highScore) {
          localStorage.setItem('highScore', userScore);
          document.getElementById('highscore').innerText = `ğŸ“ˆ ìµœê³  ê¸°ë¡: ${userScore}`;
          playSound('highscore');
          for (let i = 0; i < 3; i++) {
            setTimeout(() => confetti({ particleCount: 250, spread: 120, origin: { y: 0.6 } }), i * 400);
          }
        }

        const coop = userChoices.filter(c => c === 'í˜‘ë ¥').length;
        const betray = userChoices.filter(c => c === 'ë°°ì‹ ').length;
        const total = coop + betray;
        const coopRate = ((coop / total) * 100).toFixed(1);
        const betrayRate = ((betray / total) * 100).toFixed(1);
        document.getElementById('userStats').innerText = `ğŸ¤ í˜‘ë ¥ íšŸìˆ˜: ${coop} (${coopRate}%) | ğŸ”ª ë°°ì‹  íšŸìˆ˜: ${betray} (${betrayRate}%)`;

        chart.data.datasets[0].data = [userScore, computerScore];
        chart.update();
        document.getElementById('chartSection').style.display = 'block';
      }
    }

    function restartGame() {
      userScore = 0;
      computerScore = 0;
      round = 1;
      history = [];
      userChoices = [];
      computerStrategy = chooseStrategy();

      document.getElementById('scoreboard').innerText = `ë‹¹ì‹ : 0 | ì»´í“¨í„°: 0`;
      document.getElementById('round').innerText = `ë¼ìš´ë“œ: 1 / ${maxRounds}`;
      document.getElementById('result').innerText = '';
      document.getElementById('prediction').innerText = '';
      document.getElementById('restartBtn').style.display = 'none';
      document.getElementById('userStats').innerText = '';
      document.getElementById('chartSection').style.display = 'none';

      chart.data.datasets[0].data = [0, 0];
      chart.update();
    }
  </script>
</body>
</html>
